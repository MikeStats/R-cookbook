<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 3 Data Importing/Exporting and interaction with other programmes | DfT R Cookbook</title>
  <meta name="description" content="Guidance and code examples for R usage for DfT and beyond">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 3 Data Importing/Exporting and interaction with other programmes | DfT R Cookbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Guidance and code examples for R usage for DfT and beyond" />
  <meta name="github-repo" content="departmentfortransport/R-cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data Importing/Exporting and interaction with other programmes | DfT R Cookbook" />
  
  <meta name="twitter:description" content="Guidance and code examples for R usage for DfT and beyond" />
  

<meta name="author" content="Isi Avbulimen, Hannah Bougdah, Tamsin Forbes, Andrew Kelly, Tim Taylor">


<meta name="date" content="2019-05-09">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="intro.html">
<link rel="next" href="variables.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Why do we need <em>another</em> book?</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#coding-standards"><i class="fa fa-check"></i><b>1.1</b> Coding standards</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#adding-to-the-book"><i class="fa fa-check"></i><b>1.2</b> Adding to the book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="data-import.html"><a href="data-import.html"><i class="fa fa-check"></i><b>3</b> Data Importing/Exporting and interaction with other programmes</a><ul>
<li class="chapter" data-level="3.1" data-path="data-import.html"><a href="data-import.html#libraries"><i class="fa fa-check"></i><b>3.1</b> Libraries</a></li>
<li class="chapter" data-level="3.2" data-path="data-import.html"><a href="data-import.html#navigating-folders"><i class="fa fa-check"></i><b>3.2</b> Navigating folders</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-import.html"><a href="data-import.html#down"><i class="fa fa-check"></i><b>3.2.1</b> Down</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-import.html"><a href="data-import.html#up"><i class="fa fa-check"></i><b>3.2.2</b> Up</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-import.html"><a href="data-import.html#working-with-files-in-r"><i class="fa fa-check"></i><b>3.3</b> Working with files in R</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-import.html"><a href="data-import.html#rds"><i class="fa fa-check"></i><b>3.3.1</b> .rds</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-import.html"><a href="data-import.html#csv"><i class="fa fa-check"></i><b>3.3.2</b> .csv</a></li>
<li class="chapter" data-level="3.3.3" data-path="data-import.html"><a href="data-import.html#xls-and-.xlsx"><i class="fa fa-check"></i><b>3.3.3</b> .xls and .xlsx</a></li>
<li class="chapter" data-level="3.3.4" data-path="data-import.html"><a href="data-import.html#sav"><i class="fa fa-check"></i><b>3.3.4</b> .sav</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-import.html"><a href="data-import.html#connecting-to-databases"><i class="fa fa-check"></i><b>3.4</b> Connecting to databases</a><ul>
<li class="chapter" data-level="3.4.1" data-path="data-import.html"><a href="data-import.html#sql"><i class="fa fa-check"></i><b>3.4.1</b> SQL</a></li>
<li class="chapter" data-level="3.4.2" data-path="data-import.html"><a href="data-import.html#gcp"><i class="fa fa-check"></i><b>3.4.2</b> GCP</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="variables.html"><a href="variables.html"><i class="fa fa-check"></i><b>4</b> Vector basics</a><ul>
<li class="chapter" data-level="4.1" data-path="variables.html"><a href="variables.html#vector-types"><i class="fa fa-check"></i><b>4.1</b> Vector types</a></li>
<li class="chapter" data-level="4.2" data-path="variables.html"><a href="variables.html#coercion"><i class="fa fa-check"></i><b>4.2</b> Coercion</a><ul>
<li class="chapter" data-level="4.2.1" data-path="variables.html"><a href="variables.html#conversion-between-atomic-vector-types"><i class="fa fa-check"></i><b>4.2.1</b> Conversion between atomic vector types</a></li>
<li class="chapter" data-level="4.2.2" data-path="variables.html"><a href="variables.html#conversions-with-factors"><i class="fa fa-check"></i><b>4.2.2</b> Conversions with factors</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="variables.html"><a href="variables.html#working-with-dates"><i class="fa fa-check"></i><b>4.3</b> Working with dates</a></li>
<li class="chapter" data-level="4.4" data-path="variables.html"><a href="variables.html#working-with-factors"><i class="fa fa-check"></i><b>4.4</b> Working with factors</a></li>
<li class="chapter" data-level="4.5" data-path="variables.html"><a href="variables.html#rounding"><i class="fa fa-check"></i><b>4.5</b> Rounding</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>5</b> Table/Data Frame manipulation</a><ul>
<li class="chapter" data-level="5.1" data-path="tables.html"><a href="tables.html#pivot-and-reshape-tables"><i class="fa fa-check"></i><b>5.1</b> Pivot and reshape tables</a></li>
<li class="chapter" data-level="5.2" data-path="tables.html"><a href="tables.html#dropping-and-selecting-columns"><i class="fa fa-check"></i><b>5.2</b> Dropping and selecting columns</a></li>
<li class="chapter" data-level="5.3" data-path="tables.html"><a href="tables.html#filtering-data"><i class="fa fa-check"></i><b>5.3</b> Filtering data</a></li>
<li class="chapter" data-level="5.4" data-path="tables.html"><a href="tables.html#get-counts-of-data"><i class="fa fa-check"></i><b>5.4</b> Get counts of data</a></li>
<li class="chapter" data-level="5.5" data-path="tables.html"><a href="tables.html#combine-tables"><i class="fa fa-check"></i><b>5.5</b> Combine tables</a></li>
<li class="chapter" data-level="5.6" data-path="tables.html"><a href="tables.html#joining-tables"><i class="fa fa-check"></i><b>5.6</b> Joining tables</a></li>
<li class="chapter" data-level="5.7" data-path="tables.html"><a href="tables.html#select-specific-columns-in-a-join"><i class="fa fa-check"></i><b>5.7</b> Select specific columns in a join</a></li>
<li class="chapter" data-level="5.8" data-path="tables.html"><a href="tables.html#sum-rows-or-columns"><i class="fa fa-check"></i><b>5.8</b> Sum rows or columns</a><ul>
<li class="chapter" data-level="5.8.1" data-path="tables.html"><a href="tables.html#sum-rows"><i class="fa fa-check"></i><b>5.8.1</b> Sum rows</a></li>
<li class="chapter" data-level="5.8.2" data-path="tables.html"><a href="tables.html#sum-columns"><i class="fa fa-check"></i><b>5.8.2</b> Sum columns</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="tables.html"><a href="tables.html#replace-nas-or-other-values"><i class="fa fa-check"></i><b>5.9</b> Replace NAs or other values</a></li>
<li class="chapter" data-level="5.10" data-path="tables.html"><a href="tables.html#creating-new-variables"><i class="fa fa-check"></i><b>5.10</b> Creating new variables</a></li>
<li class="chapter" data-level="5.11" data-path="tables.html"><a href="tables.html#summarising-data"><i class="fa fa-check"></i><b>5.11</b> Summarising data</a></li>
<li class="chapter" data-level="5.12" data-path="tables.html"><a href="tables.html#look-up-tables"><i class="fa fa-check"></i><b>5.12</b> Look up tables</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="plots.html"><a href="plots.html"><i class="fa fa-check"></i><b>6</b> Plotting and Data Visualisations</a></li>
<li class="chapter" data-level="7" data-path="stats.html"><a href="stats.html"><i class="fa fa-check"></i><b>7</b> Statistical analysis</a></li>
<li class="chapter" data-level="8" data-path="advanced.html"><a href="advanced.html"><i class="fa fa-check"></i><b>8</b> Advanced</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DfT R Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-import" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Data Importing/Exporting and interaction with other programmes</h1>
<p>This chapter is for code examples of data importing/exporting and interactions with other programmes and databases.</p>
<div id="libraries" class="section level2">
<h2><span class="header-section-number">3.1</span> Libraries</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(DBI)
<span class="kw">library</span>(dbplyr)
<span class="kw">library</span>(haven)
<span class="kw">library</span>(bigrquery)</code></pre>
</div>
<div id="navigating-folders" class="section level2">
<h2><span class="header-section-number">3.2</span> Navigating folders</h2>
<p>A couple of pointers to navigate from your working directory, which, if you’re using R projects (it is highly recommended that you do) will be wherever the <code>.Rproj</code> file is located</p>
<div id="down" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Down</h3>
<p>To navigate down folders use <code>/</code>. The path given below saves the file <strong>my_df.csv</strong> in the <strong>data</strong> folder, which itself is inside the <strong>monthly_work</strong> folder</p>
<pre class="sourceCode r"><code class="sourceCode r">readr<span class="op">::</span><span class="kw">write_csv</span>(
  <span class="dt">x =</span> my_dataframe
  , <span class="dt">path =</span> <span class="st">&quot;monthly_work/data/my_df.csv&quot;</span>
)</code></pre>
</div>
<div id="up" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Up</h3>
<p>To go up a folder use <code>../</code>. In particular you may need to do this when running Rmarkdown files. Rmarkdown files use their location as the working directory. If you have created an <strong>R</strong> folder, say, to stash all your scripts in, and a <strong>data</strong> folder to stash your data files in, then you will need to go up, before going down…</p>
<p>The path below goes up one folder, then into the <strong>data</strong> folder, where the <strong>lookup_table.csv</strong> is located.</p>
<pre class="sourceCode r"><code class="sourceCode r">lookup_table &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(
  <span class="dt">file =</span> <span class="st">&quot;../data/lookup_table.csv&quot;</span>
)</code></pre>
</div>
</div>
<div id="working-with-files-in-r" class="section level2">
<h2><span class="header-section-number">3.3</span> Working with files in R</h2>
<p>This section focusses on reading in various filetypes for working on in R memory.</p>
<div id="rds" class="section level3">
<h3><span class="header-section-number">3.3.1</span> .rds</h3>
<p>.rds is R’s native file format, any object you create in R can be saved as a .rds file. The functions <code>readRDS</code> and <code>saveRDS</code> are base R functions.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">saveRDS</span>(
  <span class="dt">object =</span> my_model <span class="co">#specify the R object you want to save</span>
  , <span class="dt">file =</span> <span class="st">&quot;2019_0418_my_model.rds&quot;</span> <span class="co">#give it a name, don&#39;t forget the file extension</span>
)</code></pre>
</div>
<div id="csv" class="section level3">
<h3><span class="header-section-number">3.3.2</span> .csv</h3>
<p>We use the functions <code>read_csv</code> and <code>write_csv</code> from the <code>readr</code> package (which is part of the <code>tidyverse</code>). These are a little bit <em>cleverer</em> than their base counterparts, however, this cleverness can catch you out.</p>
<p>The file <strong>messy_pokemon_data.csv</strong> contains pokemon go captures data which has been deliberately messed up a bit. <code>read_csv</code> imputes the column specification from the first 1000 rows, which is fine if your first 1000 rows are representative of the data type. If not then subsequent data that can’t be coerced into the imputed data type will be replaced with NA.</p>
<p>Looking at the column specification below notice that <code>read_csv</code> has recognised <strong>time_first_capture</strong> as a time type, but not <strong>date_first_capture</strong> as date type. Given the information that <strong>combat_power</strong> should be numeric we can see that something is also amiss here as <code>read_csv</code> has guessed character type for this column.</p>
<pre class="sourceCode r"><code class="sourceCode r">pokemon &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(
  <span class="dt">file =</span> <span class="st">&quot;data/messy_pokemon_data.csv&quot;</span>
)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   species = col_character(),
##   combat_power = col_character(),
##   hit_points = col_double(),
##   weight_kg = col_double(),
##   weight_bin = col_character(),
##   height_m = col_double(),
##   height_bin = col_character(),
##   fast_attack = col_character(),
##   charge_attack = col_character(),
##   date_first_capture = col_character(),
##   time_first_capture = col_time(format = &quot;&quot;)
## )</code></pre>
<p>Let’s have a quick look at some data from these columns</p>
<pre class="sourceCode r"><code class="sourceCode r">pokemon <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(species, combat_power, date_first_capture, time_first_capture) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">arrange</span>(<span class="kw">desc</span>(combat_power)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">head</span>()</code></pre>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
species
</th>
<th style="text-align:left;">
combat_power
</th>
<th style="text-align:left;">
date_first_capture
</th>
<th style="text-align:left;">
time_first_capture
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
electabuzz
</td>
<td style="text-align:left;">
P962
</td>
<td style="text-align:left;">
29/04/2001
</td>
<td style="text-align:left;">
08:20:10
</td>
</tr>
<tr>
<td style="text-align:left;">
pidgey
</td>
<td style="text-align:left;">
P95
</td>
<td style="text-align:left;">
27/11/1969
</td>
<td style="text-align:left;">
21:59:32
</td>
</tr>
<tr>
<td style="text-align:left;">
drowzee
</td>
<td style="text-align:left;">
P613
</td>
<td style="text-align:left;">
18/07/1968
</td>
<td style="text-align:left;">
10:36:38
</td>
</tr>
<tr>
<td style="text-align:left;">
bulbasaur
</td>
<td style="text-align:left;">
P577
</td>
<td style="text-align:left;">
17 June 1997
</td>
<td style="text-align:left;">
09:17:17
</td>
</tr>
<tr>
<td style="text-align:left;">
drowzee
</td>
<td style="text-align:left;">
P542
</td>
<td style="text-align:left;">
04/07/1928
</td>
<td style="text-align:left;">
21:54:04
</td>
</tr>
<tr>
<td style="text-align:left;">
drowzee
</td>
<td style="text-align:left;">
P518
</td>
<td style="text-align:left;">
06/09/1950
</td>
<td style="text-align:left;">
17:01:18
</td>
</tr>
</tbody>
</table>
</div>
<p>The pokemon dataset has less than 1000 rows so <code>read_csv</code> has ‘seen’ the letters mixed in with some of the numbers in the <strong>combat_power</strong> column. It has guessed at character type because everything in the column can be coerced to character type.</p>
<p>What if there are more than 1000 rows? For example, say you have a numeric column, but there are some letters prefixed to the numbers in some of the post-row-1000 rows. These values are still meaningful to you, and with some data wrangling you can extract the actual numbers. Unfortunately <code>read_csv</code> has guessed at type double based on the first 1000 rows and since character type cannot be coerced into double, these values will be replaced with <code>NA</code>. If you have messy data like this the best thing to do is to force <code>read_csv</code> to read in as character type to preserve all values as they appear, you can then sort out the mess yourself.</p>
<p>You can specify the column data type using the <code>col_types</code> argument. Below I have used a compact string of abbreviations to specify the column types, see the help at <code>?read_csv</code> or the <code>readr</code> vignette for the full list. You can see I got many parsing failures, which I can access with <code>problems()</code>. This is a data frame of the values that <code>read_csv</code> was unable to coerce into the type I specified, and so has replaced with NA.</p>
<pre class="sourceCode r"><code class="sourceCode r">pokemon &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(
  <span class="dt">file =</span> <span class="st">&quot;data/messy_pokemon_data.csv&quot;</span>
  , <span class="dt">col_types =</span> <span class="st">&quot;cdddcdcccDt&quot;</span>
)</code></pre>
<pre><code>## Warning: 723 parsing failures.
## row                col   expected           actual                          file
##   1 date_first_capture date like  31 May 1977      &#39;data/messy_pokemon_data.csv&#39;
##   2 date_first_capture date like  24 February 1973 &#39;data/messy_pokemon_data.csv&#39;
##   3 date_first_capture date like  21 June 1924     &#39;data/messy_pokemon_data.csv&#39;
##   4 date_first_capture date like  01 August 1925   &#39;data/messy_pokemon_data.csv&#39;
##   5 date_first_capture date like  06 August 1952   &#39;data/messy_pokemon_data.csv&#39;
## ... .................. .......... ................ .............................
## See problems(...) for more details.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># c = character, d = double, D = Date, t = time</span></code></pre>
<p>Let’s take a look at the problems.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">problems</span>(pokemon) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">head</span>()</code></pre>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:right;">
row
</th>
<th style="text-align:left;">
col
</th>
<th style="text-align:left;">
expected
</th>
<th style="text-align:left;">
actual
</th>
<th style="text-align:left;">
file
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
date_first_capture
</td>
<td style="text-align:left;">
date like
</td>
<td style="text-align:left;">
31 May 1977
</td>
<td style="text-align:left;">
‘data/messy_pokemon_data.csv’
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
date_first_capture
</td>
<td style="text-align:left;">
date like
</td>
<td style="text-align:left;">
24 February 1973
</td>
<td style="text-align:left;">
‘data/messy_pokemon_data.csv’
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
date_first_capture
</td>
<td style="text-align:left;">
date like
</td>
<td style="text-align:left;">
21 June 1924
</td>
<td style="text-align:left;">
‘data/messy_pokemon_data.csv’
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
date_first_capture
</td>
<td style="text-align:left;">
date like
</td>
<td style="text-align:left;">
01 August 1925
</td>
<td style="text-align:left;">
‘data/messy_pokemon_data.csv’
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
date_first_capture
</td>
<td style="text-align:left;">
date like
</td>
<td style="text-align:left;">
06 August 1952
</td>
<td style="text-align:left;">
‘data/messy_pokemon_data.csv’
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
date_first_capture
</td>
<td style="text-align:left;">
date like
</td>
<td style="text-align:left;">
17 January 1915
</td>
<td style="text-align:left;">
‘data/messy_pokemon_data.csv’
</td>
</tr>
</tbody>
</table>
</div>
<p>And since I know that there are problems with <strong>combat_power</strong> let’s take a look there.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">problems</span>(pokemon) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(col <span class="op">==</span><span class="st"> &quot;combat_power&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">head</span>()</code></pre>
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:right;">
row
</th>
<th style="text-align:left;">
col
</th>
<th style="text-align:left;">
expected
</th>
<th style="text-align:left;">
actual
</th>
<th style="text-align:left;">
file
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
combat_power
</td>
<td style="text-align:left;">
a double
</td>
<td style="text-align:left;">
P577
</td>
<td style="text-align:left;">
‘data/messy_pokemon_data.csv’
</td>
</tr>
<tr>
<td style="text-align:right;">
96
</td>
<td style="text-align:left;">
combat_power
</td>
<td style="text-align:left;">
a double
</td>
<td style="text-align:left;">
P458
</td>
<td style="text-align:left;">
‘data/messy_pokemon_data.csv’
</td>
</tr>
<tr>
<td style="text-align:right;">
97
</td>
<td style="text-align:left;">
combat_power
</td>
<td style="text-align:left;">
a double
</td>
<td style="text-align:left;">
P455
</td>
<td style="text-align:left;">
‘data/messy_pokemon_data.csv’
</td>
</tr>
<tr>
<td style="text-align:right;">
98
</td>
<td style="text-align:left;">
combat_power
</td>
<td style="text-align:left;">
a double
</td>
<td style="text-align:left;">
P518
</td>
<td style="text-align:left;">
‘data/messy_pokemon_data.csv’
</td>
</tr>
<tr>
<td style="text-align:right;">
99
</td>
<td style="text-align:left;">
combat_power
</td>
<td style="text-align:left;">
a double
</td>
<td style="text-align:left;">
P348
</td>
<td style="text-align:left;">
‘data/messy_pokemon_data.csv’
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:left;">
combat_power
</td>
<td style="text-align:left;">
a double
</td>
<td style="text-align:left;">
P542
</td>
<td style="text-align:left;">
‘data/messy_pokemon_data.csv’
</td>
</tr>
</tbody>
</table>
</div>
<p>The <code>problems()</code> feature in <code>read_csv</code> is super useful, it helps you isolate the problem data so you can fix it.</p>
<p>Other arguments within <code>read_csv</code> that I will just mention, with their default settings are</p>
<ul>
<li><code>col_names = TRUE</code>: the first row on the imput is used as the column names.</li>
<li><code>na = c(&quot;&quot;, &quot;NA&quot;)</code>: the default values to interpret as <code>NA</code>.</li>
<li><code>trim_ws = TRUE</code>: by default trims leading/trailing white space.</li>
<li><code>skip = 0</code>: number of lines to skip before reading data.</li>
<li><code>guess_max = min(1000, n_max)</code>: maximum number of records to use for guessing column type. NB the bigger this is the longer it will take to read in the data.</li>
</ul>
</div>
<div id="xls-and-.xlsx" class="section level3">
<h3><span class="header-section-number">3.3.3</span> .xls and .xlsx</h3>
<p>Excel workbooks come in many shapes and sizes. You may have one or many worksheets in one or many workbooks, there may only be certain cells that you are interested in. Below are a few examples of how to cope with these variations using <code>readxl</code> and <code>purrr</code> to iterate over either worksheets and/or workbooks.</p>
<div id="a-single-worksheet-in-a-single-workbook" class="section level4">
<h4><span class="header-section-number">3.3.3.1</span> A single worksheet in a single workbook</h4>
<p>The simplest combination, you are interested in one rectangular datset in a particular worksheet in one workbook. Leaving the defaults works nicely on this dataset, though perhaps “units” needs some investigating.</p>
<pre class="sourceCode r"><code class="sourceCode r">data_from_xl &lt;-<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_excel</span>(
  <span class="dt">path =</span> <span class="st">&quot;data/port0499.xlsx&quot;</span>
)

tibble<span class="op">::</span><span class="kw">glimpse</span>(data_from_xl)</code></pre>
<pre><code>## Observations: 43,981
## Variables: 9
## $ year              &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000…
## $ polu_majorport    &lt;chr&gt; &quot;Aberdeen&quot;, &quot;Aberdeen&quot;, &quot;Aberdeen&quot;, &quot;Aberdeen&quot;…
## $ polu_region       &lt;chr&gt; &quot;Africa (excl. Mediterranean)&quot;, &quot;Africa (excl.…
## $ direction         &lt;chr&gt; &quot;Inwards&quot;, &quot;Outwards&quot;, &quot;Outwards&quot;, &quot;Inwards&quot;, …
## $ cargo_group       &lt;chr&gt; &quot;Other General Cargo&quot;, &quot;Other General Cargo&quot;, …
## $ cargo_category    &lt;dbl&gt; 92, 92, 99, 91, 92, 99, 23, 92, 29, 21, 23, 29…
## $ cargo_description &lt;chr&gt; &quot;Iron and steel products&quot;, &quot;Iron and steel pro…
## $ tonnage           &lt;dbl&gt; 1.1531772, 2.4061025, 3.6645449, 108.7710819, …
## $ units             &lt;dbl&gt; 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.…</code></pre>
<p>Let’s set a few of the other arguments, run <code>?read_excel</code> in the console to see the full list.</p>
<pre class="sourceCode r"><code class="sourceCode r">data_from_xl &lt;-<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_excel</span>(
  <span class="dt">path =</span> <span class="st">&quot;data/port0499.xlsx&quot;</span>
  , <span class="dt">sheet =</span> <span class="dv">1</span> <span class="co">#number or name of sheet, default is first sheet</span>
  , <span class="dt">col_names =</span> <span class="ot">TRUE</span> <span class="co">#default</span>
  , <span class="dt">col_types =</span> <span class="st">&quot;text&quot;</span> <span class="co">#a single type will recycle to all columns, specify each using character vector of the same length eg c(&quot;numeric&quot;, &quot;text&quot;, ...)</span>
)

tibble<span class="op">::</span><span class="kw">glimpse</span>(data_from_xl)</code></pre>
<pre><code>## Observations: 43,981
## Variables: 9
## $ year              &lt;chr&gt; &quot;2000&quot;, &quot;2000&quot;, &quot;2000&quot;, &quot;2000&quot;, &quot;2000&quot;, &quot;2000&quot;…
## $ polu_majorport    &lt;chr&gt; &quot;Aberdeen&quot;, &quot;Aberdeen&quot;, &quot;Aberdeen&quot;, &quot;Aberdeen&quot;…
## $ polu_region       &lt;chr&gt; &quot;Africa (excl. Mediterranean)&quot;, &quot;Africa (excl.…
## $ direction         &lt;chr&gt; &quot;Inwards&quot;, &quot;Outwards&quot;, &quot;Outwards&quot;, &quot;Inwards&quot;, …
## $ cargo_group       &lt;chr&gt; &quot;Other General Cargo&quot;, &quot;Other General Cargo&quot;, …
## $ cargo_category    &lt;chr&gt; &quot;92&quot;, &quot;92&quot;, &quot;99&quot;, &quot;91&quot;, &quot;92&quot;, &quot;99&quot;, &quot;23&quot;, &quot;92&quot;…
## $ cargo_description &lt;chr&gt; &quot;Iron and steel products&quot;, &quot;Iron and steel pro…
## $ tonnage           &lt;chr&gt; &quot;1.15317721340056&quot;, &quot;2.4061025320368699&quot;, &quot;3.6…
## $ units             &lt;chr&gt; &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;…</code></pre>
</div>
<div id="a-single-worksheet-in-many-workbooks" class="section level4">
<h4><span class="header-section-number">3.3.3.2</span> A single worksheet in many workbooks</h4>
<p>For example, you collect sea passenger count data from many ferry companies, the data all has the same struture and you want to read it in and row bind into a single dataframe in R.</p>
</div>
<div id="many-worksheets-in-a-single-workbook" class="section level4">
<h4><span class="header-section-number">3.3.3.3</span> Many worksheets in a single workbook</h4>
<p>You have a single workbook, but it contains many worksheets of interest, each containing rectangular data with the same structure.</p>
</div>
<div id="many-worksheets-in-many-workbooks" class="section level4">
<h4><span class="header-section-number">3.3.3.4</span> Many worksheets in many workbooks</h4>
</div>
<div id="non-rectangular-data-in-many-workbooks" class="section level4">
<h4><span class="header-section-number">3.3.3.5</span> Non-rectangular data in many workbooks</h4>
<p>You have received some kind of data entry form that has been done in excel in a more human readable, rather than machine readable, format. Some of the cells contain instructions and admin data so you only want the data held in specific cells. This is non-rectangular data, that is, the data of interest is dotted all over the place.</p>
<ul>
<li>read .xls/s</li>
<li>read single tab</li>
<li>read many tabs from one workbook (FASTS)</li>
<li>read individual cells/cell ranges (SP)</li>
<li>write with formatting openxlsx/xltabr</li>
</ul>
</div>
</div>
<div id="sav" class="section level3">
<h3><span class="header-section-number">3.3.4</span> .sav</h3>
</div>
</div>
<div id="connecting-to-databases" class="section level2">
<h2><span class="header-section-number">3.4</span> Connecting to databases</h2>
<div id="sql" class="section level3">
<h3><span class="header-section-number">3.4.1</span> SQL</h3>
<ul>
<li>DBI</li>
<li>default schema</li>
<li>link to C&amp;C talks on the subject</li>
</ul>
</div>
<div id="gcp" class="section level3">
<h3><span class="header-section-number">3.4.2</span> GCP</h3>
<ul>
<li>BigQuery - bigrquery</li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="variables.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
