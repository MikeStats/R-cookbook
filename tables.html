<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Table/Data Frame manipulation | DfT R Cookbook</title>
  <meta name="description" content="Guidance and code examples for R usage for DfT and beyond" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Table/Data Frame manipulation | DfT R Cookbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Guidance and code examples for R usage for DfT and beyond" />
  <meta name="github-repo" content="departmentfortransport/R-cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Table/Data Frame manipulation | DfT R Cookbook" />
  
  <meta name="twitter:description" content="Guidance and code examples for R usage for DfT and beyond" />
  

<meta name="author" content="Isi Avbulimen, Hannah Bougdah, Tamsin Forbes, Andrew Kelly, Tim Taylor" />


<meta name="date" content="2019-08-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-import.html">
<link rel="next" href="dates.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.8/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Why do we need <em>another</em> book?</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#coding-standards"><i class="fa fa-check"></i><b>1.1</b> Coding standards</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#adding-to-the-book"><i class="fa fa-check"></i><b>1.2</b> Adding to the book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> The basics</a><ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#r-family"><i class="fa fa-check"></i><b>2.1</b> R family</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#dft-rrstudio---subject-to-change"><i class="fa fa-check"></i><b>2.2</b> DfT R/RStudio - subject to change</a></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#rstudio-ide"><i class="fa fa-check"></i><b>2.3</b> RStudio IDE</a></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#projects"><i class="fa fa-check"></i><b>2.4</b> Projects</a><ul>
<li class="chapter" data-level="2.4.1" data-path="basics.html"><a href="basics.html#folders"><i class="fa fa-check"></i><b>2.4.1</b> folders</a></li>
<li class="chapter" data-level="2.4.2" data-path="basics.html"><a href="basics.html#sessioninfo"><i class="fa fa-check"></i><b>2.4.2</b> sessionInfo()</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#r-memory"><i class="fa fa-check"></i><b>2.5</b> R memory</a></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#assignement-operators---vs"><i class="fa fa-check"></i><b>2.6</b> Assignement operators <code>&lt;-</code> vs <code>=</code></a></li>
<li class="chapter" data-level="2.7" data-path="basics.html"><a href="basics.html#arithmetic-operators"><i class="fa fa-check"></i><b>2.7</b> Arithmetic operators</a></li>
<li class="chapter" data-level="2.8" data-path="basics.html"><a href="basics.html#relational-operators"><i class="fa fa-check"></i><b>2.8</b> Relational operators</a></li>
<li class="chapter" data-level="2.9" data-path="basics.html"><a href="basics.html#logical-operators"><i class="fa fa-check"></i><b>2.9</b> Logical operators</a></li>
<li class="chapter" data-level="2.10" data-path="basics.html"><a href="basics.html#vectors"><i class="fa fa-check"></i><b>2.10</b> Vectors</a><ul>
<li class="chapter" data-level="2.10.1" data-path="basics.html"><a href="basics.html#vector-types"><i class="fa fa-check"></i><b>2.10.1</b> Types</a></li>
<li class="chapter" data-level="2.10.2" data-path="basics.html"><a href="basics.html#conversion-between-atomic-vector-types"><i class="fa fa-check"></i><b>2.10.2</b> Conversion between atomic vector types</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-import.html"><a href="data-import.html"><i class="fa fa-check"></i><b>3</b> Data Importing/Exporting and interaction with other programmes</a><ul>
<li class="chapter" data-level="3.1" data-path="data-import.html"><a href="data-import.html#libraries"><i class="fa fa-check"></i><b>3.1</b> Libraries</a></li>
<li class="chapter" data-level="3.2" data-path="data-import.html"><a href="data-import.html#star-functions"><i class="fa fa-check"></i><b>3.2</b> Star functions</a></li>
<li class="chapter" data-level="3.3" data-path="data-import.html"><a href="data-import.html#navigating-folders"><i class="fa fa-check"></i><b>3.3</b> Navigating folders</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-import.html"><a href="data-import.html#down"><i class="fa fa-check"></i><b>3.3.1</b> Down</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-import.html"><a href="data-import.html#up"><i class="fa fa-check"></i><b>3.3.2</b> Up</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-import.html"><a href="data-import.html#working-with-files-in-r"><i class="fa fa-check"></i><b>3.4</b> Working with files in R</a><ul>
<li class="chapter" data-level="3.4.1" data-path="data-import.html"><a href="data-import.html#rds"><i class="fa fa-check"></i><b>3.4.1</b> .rds</a></li>
<li class="chapter" data-level="3.4.2" data-path="data-import.html"><a href="data-import.html#csv"><i class="fa fa-check"></i><b>3.4.2</b> .csv</a></li>
<li class="chapter" data-level="3.4.3" data-path="data-import.html"><a href="data-import.html#xlsx-and-.xls"><i class="fa fa-check"></i><b>3.4.3</b> .xlsx and .xls</a></li>
<li class="chapter" data-level="3.4.4" data-path="data-import.html"><a href="data-import.html#exporting-to-.xlsx"><i class="fa fa-check"></i><b>3.4.4</b> Exporting to .xlsx</a></li>
<li class="chapter" data-level="3.4.5" data-path="data-import.html"><a href="data-import.html#sav"><i class="fa fa-check"></i><b>3.4.5</b> .sav</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="data-import.html"><a href="data-import.html#connecting-to-databases"><i class="fa fa-check"></i><b>3.5</b> Connecting to databases</a><ul>
<li class="chapter" data-level="3.5.1" data-path="data-import.html"><a href="data-import.html#sql"><i class="fa fa-check"></i><b>3.5.1</b> SQL</a></li>
<li class="chapter" data-level="3.5.2" data-path="data-import.html"><a href="data-import.html#gcp"><i class="fa fa-check"></i><b>3.5.2</b> GCP</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>4</b> Table/Data Frame manipulation</a><ul>
<li class="chapter" data-level="4.1" data-path="tables.html"><a href="tables.html#pivot-and-reshape-tables"><i class="fa fa-check"></i><b>4.1</b> Pivot and reshape tables</a></li>
<li class="chapter" data-level="4.2" data-path="tables.html"><a href="tables.html#dropping-and-selecting-columns"><i class="fa fa-check"></i><b>4.2</b> Dropping and selecting columns</a></li>
<li class="chapter" data-level="4.3" data-path="tables.html"><a href="tables.html#filtering-data"><i class="fa fa-check"></i><b>4.3</b> Filtering data</a></li>
<li class="chapter" data-level="4.4" data-path="tables.html"><a href="tables.html#group-data"><i class="fa fa-check"></i><b>4.4</b> Group data</a></li>
<li class="chapter" data-level="4.5" data-path="tables.html"><a href="tables.html#order-data"><i class="fa fa-check"></i><b>4.5</b> Order data</a></li>
<li class="chapter" data-level="4.6" data-path="tables.html"><a href="tables.html#get-counts-of-data"><i class="fa fa-check"></i><b>4.6</b> Get counts of data</a></li>
<li class="chapter" data-level="4.7" data-path="tables.html"><a href="tables.html#combine-tables"><i class="fa fa-check"></i><b>4.7</b> Combine tables</a></li>
<li class="chapter" data-level="4.8" data-path="tables.html"><a href="tables.html#joining-tables"><i class="fa fa-check"></i><b>4.8</b> Joining tables</a></li>
<li class="chapter" data-level="4.9" data-path="tables.html"><a href="tables.html#select-specific-columns-in-a-join"><i class="fa fa-check"></i><b>4.9</b> Select specific columns in a join</a></li>
<li class="chapter" data-level="4.10" data-path="tables.html"><a href="tables.html#sum-rows-or-columns"><i class="fa fa-check"></i><b>4.10</b> Sum rows or columns</a><ul>
<li class="chapter" data-level="4.10.1" data-path="tables.html"><a href="tables.html#sum-rows"><i class="fa fa-check"></i><b>4.10.1</b> Sum rows</a></li>
<li class="chapter" data-level="4.10.2" data-path="tables.html"><a href="tables.html#sum-columns"><i class="fa fa-check"></i><b>4.10.2</b> Sum columns</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="tables.html"><a href="tables.html#replace-nas-or-other-values"><i class="fa fa-check"></i><b>4.11</b> Replace NAs or other values</a></li>
<li class="chapter" data-level="4.12" data-path="tables.html"><a href="tables.html#reordering-rowscolumns"><i class="fa fa-check"></i><b>4.12</b> Reordering rows/columns</a><ul>
<li class="chapter" data-level="4.12.1" data-path="tables.html"><a href="tables.html#reordering-rows"><i class="fa fa-check"></i><b>4.12.1</b> Reordering rows</a></li>
<li class="chapter" data-level="4.12.2" data-path="tables.html"><a href="tables.html#reordering-columns"><i class="fa fa-check"></i><b>4.12.2</b> Reordering columns</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="tables.html"><a href="tables.html#creating-new-variables"><i class="fa fa-check"></i><b>4.13</b> Creating new variables</a></li>
<li class="chapter" data-level="4.14" data-path="tables.html"><a href="tables.html#summarising-data"><i class="fa fa-check"></i><b>4.14</b> Summarising data</a></li>
<li class="chapter" data-level="4.15" data-path="tables.html"><a href="tables.html#look-up-tables"><i class="fa fa-check"></i><b>4.15</b> Look up tables</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dates.html"><a href="dates.html"><i class="fa fa-check"></i><b>5</b> Working with dates</a></li>
<li class="chapter" data-level="6" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>6</b> Working with factors</a><ul>
<li class="chapter" data-level="6.1" data-path="factors.html"><a href="factors.html#common-uses"><i class="fa fa-check"></i><b>6.1</b> Common uses</a><ul>
<li class="chapter" data-level="6.1.1" data-path="factors.html"><a href="factors.html#tabulation-of-data"><i class="fa fa-check"></i><b>6.1.1</b> Tabulation of data</a></li>
<li class="chapter" data-level="6.1.2" data-path="factors.html"><a href="factors.html#ordering-of-data-for-output"><i class="fa fa-check"></i><b>6.1.2</b> Ordering of data for output</a></li>
<li class="chapter" data-level="6.1.3" data-path="factors.html"><a href="factors.html#statistical-models"><i class="fa fa-check"></i><b>6.1.3</b> Statistical models</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="factors.html"><a href="factors.html#other-things-to-know-about-factors"><i class="fa fa-check"></i><b>6.2</b> Other things to know about factors</a><ul>
<li class="chapter" data-level="6.2.1" data-path="factors.html"><a href="factors.html#renaming-factor-levels"><i class="fa fa-check"></i><b>6.2.1</b> Renaming factor levels</a></li>
<li class="chapter" data-level="6.2.2" data-path="factors.html"><a href="factors.html#combining-factors-does-not-result-in-a-factor"><i class="fa fa-check"></i><b>6.2.2</b> Combining factors does not result in a factor</a></li>
<li class="chapter" data-level="6.2.3" data-path="factors.html"><a href="factors.html#numeric-vectors-that-have-been-read-as-factors"><i class="fa fa-check"></i><b>6.2.3</b> Numeric vectors that have been read as factors</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="factors.html"><a href="factors.html#helpful-packages"><i class="fa fa-check"></i><b>6.3</b> Helpful packages</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="plots.html"><a href="plots.html"><i class="fa fa-check"></i><b>7</b> Plotting and Data Visualisations</a></li>
<li class="chapter" data-level="8" data-path="tidbits.html"><a href="tidbits.html"><i class="fa fa-check"></i><b>8</b> Interesting tidbits</a><ul>
<li class="chapter" data-level="8.1" data-path="tidbits.html"><a href="tidbits.html#rounding"><i class="fa fa-check"></i><b>8.1</b> Rounding</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DfT R Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tables" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Table/Data Frame manipulation</h1>
<p>This chapter provides an overview of code examples for table or data frame manipulation (a tidyverse data frame is referred to as a tibble).</p>
<p>One of the main things you will have to do in any R project or RAP project will be manipulating the data that you are using in order to get it into the format you require.</p>
<p>One of the main packages used to manipulate data is the dplyr package which we recommend and use throughout this book. The dplyr package (and others e.g. tidyr) are all part of the tidyverse. The tidyverse is a group of packages developed by Hadley Wickham and others and are all designed to work with each other. See <a href="https://www.tidyverse.org/" class="uri">https://www.tidyverse.org/</a> for more info.</p>
<p><strong>Tidyverse packages and functions can be combined and layered using the pipe operator <code>%&gt;%</code>.</strong></p>
<p>Dplyr is built to work with <strong>tidy data</strong>. To find out more about tidy data please look at the following link <a href="https://r4ds.had.co.nz/tidy-data.html" class="uri">https://r4ds.had.co.nz/tidy-data.html</a> but the general principles are:</p>
<ol style="list-style-type: decimal">
<li>Each variables must have its own column</li>
<li>Each observation must have its own row</li>
<li>Each value must have its own cell</li>
</ol>
<div id="pivot-and-reshape-tables" class="section level2">
<h2><span class="header-section-number">4.1</span> Pivot and reshape tables</h2>
<p>There will be two examples for pivoting tables provided:</p>
<ul>
<li>The tidyr package uses the gather/spread functions and is often used to create tidy data</li>
<li>The reshape2 package is also a useful package to pivot tables and has added functionality such as providing totals of columns etc.</li>
</ul>
<p>We want to have the day of the week variable running along the top so each day of the week is its own column.</p>
<table>
<caption>
<span id="tab:unnamed-chunk-64">Table 4.1: </span>Number of road accidents by accident severity and weekday
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
205
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
187
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
233
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
220
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
250
</td>
</tr>
</tbody>
</table>
<p><strong>Tidyr package</strong></p>
<p>Using the tidyr package, gather and spread functions can be used to pivot the table views:</p>
<ul>
<li><p><strong>gather</strong> makes wide data longer i.e. variables running along the top can be “gathered” into rows running down.</p></li>
<li><p><strong>spread</strong> makes long data wider i.e. one variable can be spread and run along the top with each value being a variable.</p></li>
</ul>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1"><span class="co"># Pivot table using tidyr package</span></a>
<a class="sourceLine" id="cb119-2" data-line-number="2"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb119-3" data-line-number="3">road_accidents_weekdays &lt;-<span class="st"> </span>road_accidents_small <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-4" data-line-number="4"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">spread</span>(Day_of_Week, n)</a></code></pre></div>
<p>With the spread function above you need to first specify the variable you want to spread, in this case Day_of_Week, and then the variable that will be used to populate the columns (n).</p>
<table>
<caption>
<span id="tab:unnamed-chunk-66">Table 4.2: </span>Number of road accidents by accident severity and weekday, tidyr::spread
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
1
</th>
<th style="text-align:right;">
2
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
5
</th>
<th style="text-align:right;">
6
</th>
<th style="text-align:right;">
7
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
<td style="text-align:right;">
205
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:right;">
233
</td>
<td style="text-align:right;">
220
</td>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
281
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3009
</td>
<td style="text-align:right;">
2948
</td>
<td style="text-align:right;">
3230
</td>
<td style="text-align:right;">
3227
</td>
<td style="text-align:right;">
3246
</td>
<td style="text-align:right;">
3649
</td>
<td style="text-align:right;">
3225
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11668
</td>
<td style="text-align:right;">
14783
</td>
<td style="text-align:right;">
16065
</td>
<td style="text-align:right;">
15859
</td>
<td style="text-align:right;">
16331
</td>
<td style="text-align:right;">
17346
</td>
<td style="text-align:right;">
13720
</td>
</tr>
</tbody>
</table>
<p>The opposite can also be done using the gather function: GET HELP ON THIS</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1"><span class="co"># Pivot table using tidyr package</span></a>
<a class="sourceLine" id="cb120-2" data-line-number="2"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb120-3" data-line-number="3">road_accidents_gather &lt;-<span class="st"> </span>road_accidents_weekdays <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb120-4" data-line-number="4"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">gather</span>(Accident_Severity, n, <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>)</a></code></pre></div>
<p><strong>Reshape2 package</strong></p>
<p>Again, this has two functions which can be used to pivot tables:</p>
<ul>
<li><p><strong>melt</strong> makes wide data longer</p></li>
<li><p><strong>dcast</strong> makes long data wider</p></li>
</ul>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="co"># Pivot table using reshape2 package</span></a>
<a class="sourceLine" id="cb121-2" data-line-number="2"><span class="kw">library</span>(reshape2)</a>
<a class="sourceLine" id="cb121-3" data-line-number="3">road_accidents_weekdays2 &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">dcast</span>(road_accidents_small, Accident_Severity <span class="op">~</span><span class="st"> </span>Day_of_Week,</a>
<a class="sourceLine" id="cb121-4" data-line-number="4">                                            <span class="dt">value.var =</span> <span class="st">&quot;n&quot;</span>)</a></code></pre></div>
<p>With the dcast function above, after stating the name of the data frame, you need to specify the variable(s) you want in long format (multiple variables seperated by “+”), in this case Accident_Severity, and then the wide format variable(s) are put after the tilda (again multiple seperated by “+”). The value.var argument specifies which column will be used to populate the new columns, in this case it is n.</p>
<table>
<caption>
<span id="tab:unnamed-chunk-69">Table 4.3: </span>Number of road accidents by accident severity and weekday, reshape2::dcast
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
1
</th>
<th style="text-align:right;">
2
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
5
</th>
<th style="text-align:right;">
6
</th>
<th style="text-align:right;">
7
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
<td style="text-align:right;">
205
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:right;">
233
</td>
<td style="text-align:right;">
220
</td>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
281
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3009
</td>
<td style="text-align:right;">
2948
</td>
<td style="text-align:right;">
3230
</td>
<td style="text-align:right;">
3227
</td>
<td style="text-align:right;">
3246
</td>
<td style="text-align:right;">
3649
</td>
<td style="text-align:right;">
3225
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11668
</td>
<td style="text-align:right;">
14783
</td>
<td style="text-align:right;">
16065
</td>
<td style="text-align:right;">
15859
</td>
<td style="text-align:right;">
16331
</td>
<td style="text-align:right;">
17346
</td>
<td style="text-align:right;">
13720
</td>
</tr>
</tbody>
</table>
<p>If you want to create sums and totals of the tables this can also be done using reshape2. For example, taking the original table, we want to pivot it and sum each severity to get the total number of accidents per day.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1"><span class="co"># Pivot table using reshape2 package</span></a>
<a class="sourceLine" id="cb122-2" data-line-number="2"><span class="kw">library</span>(reshape2)</a>
<a class="sourceLine" id="cb122-3" data-line-number="3">road_accidents_weekdays3 &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">dcast</span>(road_accidents_small, Accident_Severity <span class="op">~</span><span class="st"> </span>Day_of_Week,</a>
<a class="sourceLine" id="cb122-4" data-line-number="4">                                            <span class="dt">value.var =</span> <span class="st">&quot;n&quot;</span>, sum, <span class="dt">margins =</span> <span class="st">&quot;Accident_Severity&quot;</span>)</a></code></pre></div>
<p>In this example, we use the margins argument to specify what we want to combine to create totals. So we want to add all the accident severity figures up for each weekday. Before using margin you need to specify how the margins are calculated, in this case we want a sum. Alternative options are to calculate the length, i.e. the number of rows.</p>
<table>
<caption>
<span id="tab:unnamed-chunk-71">Table 4.4: </span>Number of road accidents by accident severity and weekday plus totals, reshape2::dcast
</caption>
<thead>
<tr>
<th style="text-align:left;">
Accident_Severity
</th>
<th style="text-align:right;">
1
</th>
<th style="text-align:right;">
2
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
5
</th>
<th style="text-align:right;">
6
</th>
<th style="text-align:right;">
7
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
300
</td>
<td style="text-align:right;">
205
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:right;">
233
</td>
<td style="text-align:right;">
220
</td>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
281
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
3009
</td>
<td style="text-align:right;">
2948
</td>
<td style="text-align:right;">
3230
</td>
<td style="text-align:right;">
3227
</td>
<td style="text-align:right;">
3246
</td>
<td style="text-align:right;">
3649
</td>
<td style="text-align:right;">
3225
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
11668
</td>
<td style="text-align:right;">
14783
</td>
<td style="text-align:right;">
16065
</td>
<td style="text-align:right;">
15859
</td>
<td style="text-align:right;">
16331
</td>
<td style="text-align:right;">
17346
</td>
<td style="text-align:right;">
13720
</td>
</tr>
<tr>
<td style="text-align:left;">
(all)
</td>
<td style="text-align:right;">
14977
</td>
<td style="text-align:right;">
17936
</td>
<td style="text-align:right;">
19482
</td>
<td style="text-align:right;">
19319
</td>
<td style="text-align:right;">
19797
</td>
<td style="text-align:right;">
21245
</td>
<td style="text-align:right;">
17226
</td>
</tr>
</tbody>
</table>
<p>The opposite can also be done using the melt function.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="co"># Pivot table using reshape2 package</span></a>
<a class="sourceLine" id="cb123-2" data-line-number="2"><span class="kw">library</span>(reshape2)</a>
<a class="sourceLine" id="cb123-3" data-line-number="3">road_accidents_melt &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(road_accidents_weekdays2, <span class="dt">id.vars =</span> <span class="st">&quot;Accident_Severity&quot;</span>,</a>
<a class="sourceLine" id="cb123-4" data-line-number="4">                                      <span class="dt">measure.vars =</span> <span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;7&quot;</span>),</a>
<a class="sourceLine" id="cb123-5" data-line-number="5">                                      <span class="dt">variable.name =</span> <span class="st">&quot;Day_of_Week&quot;</span>, <span class="dt">value.name =</span> <span class="st">&quot;n&quot;</span>)</a></code></pre></div>
<p>For the melt function you need to specify:</p>
<p>id.vars = “variables to be kept as columns”</p>
<p>measure.vars = c(“variables to be created as one column”)</p>
<p>variable.name = “name of created column using the measure.vars”</p>
<p>value.name = “name of value column”</p>
<table>
<caption>
<span id="tab:unnamed-chunk-73">Table 4.5: </span>Number of road accidents by accident severity and weekday, reshape2::melt
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:left;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
300
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
3009
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
11668
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
205
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
2948
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
14783
</td>
</tr>
</tbody>
</table>
</div>
<div id="dropping-and-selecting-columns" class="section level2">
<h2><span class="header-section-number">4.2</span> Dropping and selecting columns</h2>
<p>Use the dplyr select function to both select and drop columns.</p>
<p><strong>Select columns</strong></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1">road_accidents_<span class="dv">4</span>_cols &lt;-<span class="st"> </span>road_accidents <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(acc_index, Accident_Severity, Date, Police_Force)</a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-75">Table 4.6: </span>Four columns from road accidents 2017
</caption>
<thead>
<tr>
<th style="text-align:left;">
acc_index
</th>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:right;">
Police_Force
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2017010001708
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-08-05
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009342
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009344
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009348
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009350
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009351
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p><strong>Drop columns</strong></p>
<p>Note that to drop columns the difference is putting a “-” in front of the variable name.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">road_accidents_<span class="dv">3</span>_cols &lt;-<span class="st"> </span>road_accidents_<span class="dv">4</span>_cols <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>Police_Force)</a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-77">Table 4.7: </span>Three columns from road accidents 2017
</caption>
<thead>
<tr>
<th style="text-align:left;">
acc_index
</th>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2017010001708
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-08-05
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009342
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009344
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009348
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009350
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
2017-01-01
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009351
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
</tr>
</tbody>
</table>
</div>
<div id="filtering-data" class="section level2">
<h2><span class="header-section-number">4.3</span> Filtering data</h2>
<p>Use the dplyr filter function to filter data.</p>
<p>This example filters the data for slight severity accidents (accident severity 3).</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1">road_accidents_slight &lt;-<span class="st"> </span>road_accidents_<span class="dv">4</span>_cols <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(Accident_Severity <span class="op">==</span><span class="st"> </span><span class="dv">3</span>)</a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-79">Table 4.8: </span>Slight severity road accidents 2017
</caption>
<thead>
<tr>
<th style="text-align:left;">
acc_index
</th>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:right;">
Police_Force
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2017010009342
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009344
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009348
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009351
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009353
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009354
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>To filter multiple conditions:</p>
<p>And operator</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">road_accidents_filter &lt;-<span class="st"> </span>road_accidents_<span class="dv">4</span>_cols <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(Accident_Severity <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;</span><span class="st"> </span>Police_Force <span class="op">==</span><span class="st"> </span><span class="dv">4</span>)</a></code></pre></div>
<p>Or operator</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1">road_accidents_filter2 &lt;-<span class="st"> </span>road_accidents_<span class="dv">4</span>_cols <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb128-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(Accident_Severity <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>Accident_Severity <span class="op">==</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<p><strong>Note: filtering with characters must be wrapped in “quotations” e.g:</strong></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">road_accidents_filter3 &lt;-<span class="st"> </span>road_accidents <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb129-2" data-line-number="2">dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Local_Authority_(Highway)</span><span class="st">`</span> <span class="op">==</span><span class="st"> &quot;E09000010&quot;</span>)</a></code></pre></div>
<p>Also note that in the above example the variable is quoted in back ticks (`). This is because some variable names confuse R due to brackets and numbers and need to be wrapped in back ticks so R knows that everything inside the back ticks is a variable name.</p>
</div>
<div id="group-data" class="section level2">
<h2><span class="header-section-number">4.4</span> Group data</h2>
<p>Use the dplyr group_by function to group data. This works in a similar manner to “GROUP BY” in SQL.</p>
<p>The below example groups the data by accident severity and weekday, and creates totals for each group using the “tally” function.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1"><span class="co"># Create grouped data set with counts</span></a>
<a class="sourceLine" id="cb130-2" data-line-number="2">road_accidents_small &lt;-<span class="st"> </span>road_accidents <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb130-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(Accident_Severity, Day_of_Week) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb130-4" data-line-number="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">tally</span>()</a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-84">Table 4.9: </span>Road accidents 2017 by accident severity and weekday
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
205
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
187
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
233
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
220
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
250
</td>
</tr>
</tbody>
</table>
</div>
<div id="order-data" class="section level2">
<h2><span class="header-section-number">4.5</span> Order data</h2>
<p>Use the dplyr arrange function to order data. This works in a similar manner to “ORDER BY” in SQL.</p>
<p>This example orders the data by date and number of casualties.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="co"># Order data by date and number of casualties</span></a>
<a class="sourceLine" id="cb131-2" data-line-number="2">road_accidents_ordered &lt;-<span class="st"> </span>road_acc_<span class="dv">7</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(acc_index, Accident_Severity, Police_Force, Number_of_Casualties, Date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-4" data-line-number="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">arrange</span>(Date, Number_of_Casualties)</a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-87">Table 4.10: </span>Road accidents 2017 ordered by date and number of casualties
</caption>
<thead>
<tr>
<th style="text-align:left;">
acc_index
</th>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Police_Force
</th>
<th style="text-align:right;">
Number_of_Casualties
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2017010029916
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-04-04
</td>
</tr>
<tr>
<td style="text-align:left;">
2017471704202
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-06-29
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010047469
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-07-10
</td>
</tr>
<tr>
<td style="text-align:left;">
2017610033217
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-08-12
</td>
</tr>
<tr>
<td style="text-align:left;">
201763A087117
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-09-09
</td>
</tr>
<tr>
<td style="text-align:left;">
201706N034989
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-09-18
</td>
</tr>
</tbody>
</table>
</div>
<div id="get-counts-of-data" class="section level2">
<h2><span class="header-section-number">4.6</span> Get counts of data</h2>
<p>To get counts for groups of data, the dplyr tally function can be used in conjunction with the dplyr group by function. This groups the data into the required groups and then tallys how many records are in each group.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1"><span class="co"># Create grouped data set with counts</span></a>
<a class="sourceLine" id="cb132-2" data-line-number="2">road_accidents_small &lt;-<span class="st"> </span>road_accidents <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(Accident_Severity, Day_of_Week) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-4" data-line-number="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">tally</span>()</a></code></pre></div>
<p>The above example creates groups by accident severity and weekday and counts how many accidents are in each group (one row equals one accident therefore the tally is counting accidents).</p>
<table>
<caption>
<span id="tab:unnamed-chunk-89">Table 4.11: </span>Road accidents 2017 by accident severity and weekday
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
205
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
187
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
233
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
220
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
250
</td>
</tr>
</tbody>
</table>
</div>
<div id="combine-tables" class="section level2">
<h2><span class="header-section-number">4.7</span> Combine tables</h2>
<p>When combining data from two tables there are two ways to do this in R:</p>
<ul>
<li>Bind the tables by basically either appending the tables on the rows or columns</li>
<li>Join the tables using the dplyr version of SQL joins</li>
</ul>
<p><strong>Binding tables</strong></p>
<p>Binding tables is mainly done to append tables by creating more rows, however tables can also be binded by adding more columns. Although it is recommended to use the dplyr join functions to combine columns (see 5.6).</p>
<p>Here are three tables, one shows data for accident severity of 1, one for accident severity of 2, and one for accident severity of 3.</p>
<table>
<caption>
<span id="tab:unnamed-chunk-91">Table 4.12: </span>Number of fatal road accidents in 2017, by weekday
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
205
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
187
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
233
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
220
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
250
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
281
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:unnamed-chunk-91">Table 4.12: </span>Number of serious injury road accidents in 2017, by weekday
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3009
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2948
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3230
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3227
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3246
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
3649
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3225
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:unnamed-chunk-91">Table 4.12: </span>Number of slight injury road accidents in 2017, by weekday
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11668
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
14783
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
16065
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
15859
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
16331
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
17346
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
13720
</td>
</tr>
</tbody>
</table>
<p>To combine these tables we can use the bind_rows function from the dplyr package. Use bind_rows when you want to append the tables underneath one another to make one longer table, i.e. you want to add more rows.</p>
<p><strong>Ensure that the column names for each table are exactly the same in each table.</strong></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1"><span class="co"># combine tables using bind_rows</span></a>
<a class="sourceLine" id="cb133-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb133-3" data-line-number="3"></a>
<a class="sourceLine" id="cb133-4" data-line-number="4">all_accidents &lt;-<span class="st"> </span>accidents_<span class="dv">1</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-5" data-line-number="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">bind_rows</span>(accidents_<span class="dv">2</span>, accidents_<span class="dv">3</span>)</a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-93">Table 4.13: </span>Road accident data 2017, bind_rows
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
205
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
187
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
233
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
220
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
250
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
281
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3009
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2948
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3230
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3227
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3246
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
3649
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3225
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11668
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
14783
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
16065
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
15859
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
16331
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
17346
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
13720
</td>
</tr>
</tbody>
</table>
</div>
<div id="joining-tables" class="section level2">
<h2><span class="header-section-number">4.8</span> Joining tables</h2>
<p>Joins in R can be done using dplyr. This is generally to combine columns of data from two tables:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1"><span class="co"># combine tables using left join</span></a>
<a class="sourceLine" id="cb134-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb134-3" data-line-number="3"></a>
<a class="sourceLine" id="cb134-4" data-line-number="4">all_accidents_cols_join &lt;-<span class="st"> </span>road_acc_<span class="dv">1</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-5" data-line-number="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">left_join</span>(road_acc_<span class="dv">2</span>, <span class="dt">by =</span> <span class="st">&quot;acc_index&quot;</span>)</a></code></pre></div>
<p>This uses the same principles as SQL, by specifying what the tables should be joined on using the <strong>by =</strong> argument.</p>
<p>Dplyr has all the usual SQL joins for example, inner_join, full_join, right_join. All of these are used in the same way as the left join example above.</p>
<p>Another useful join for data manipulation is an anti_join. This provides all the data that is not in the joined table. For example, the below snapshot of a table displays road accident totals broken down by accident severity and weekday:</p>
<table>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
205
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
187
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
233
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
220
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
250
</td>
</tr>
</tbody>
</table>
<p>I am interested in creating two sub-groups of this data, a table for all accidents on a Monday (weekday 2), and all other accidents.</p>
<p>First, I get the Monday data using the dplyr filter function (see 5.3).</p>
<table>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
205
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2948
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
14783
</td>
</tr>
</tbody>
</table>
<p>Then, I can use an anti-join to create a table which has all of the data that is not in the above table:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="co"># create table of all rows not in the joined table</span></a>
<a class="sourceLine" id="cb135-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb135-3" data-line-number="3"></a>
<a class="sourceLine" id="cb135-4" data-line-number="4">all_accidents_not_monday &lt;-<span class="st"> </span>road_accidents_small <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-5" data-line-number="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">anti_join</span>(accidents_monday, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Accident_Severity&quot;</span>, <span class="st">&quot;Day_of_Week&quot;</span>))</a></code></pre></div>
<p>The above code takes the initial table we want to get our data from (road_accidents_small) and anti joins accidents_monday. This says, “get all the rows from road_accidents_small that are not in accidents_monday”. Again, note the need to specify what the join rows would be joined and compared by.</p>
<table>
<caption>
<span id="tab:unnamed-chunk-100">Table 4.14: </span>Road accident data 2017 not on a Monday by accident severity
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
187
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
233
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
220
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
250
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
281
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3009
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3230
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3227
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3246
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
3649
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3225
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11668
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
16065
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
15859
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
16331
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
17346
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
13720
</td>
</tr>
</tbody>
</table>
</div>
<div id="select-specific-columns-in-a-join" class="section level2">
<h2><span class="header-section-number">4.9</span> Select specific columns in a join</h2>
<p>Doing a join with dplyr will join all columns from both tables, however sometimes not all columns from each table are needed.</p>
<p>Let’s look at some previous tables again:</p>
<table>
<caption>
<span id="tab:unnamed-chunk-101">Table 4.15: </span>Police force and accident severity information for accidents
</caption>
<thead>
<tr>
<th style="text-align:left;">
acc_index
</th>
<th style="text-align:right;">
Police_Force
</th>
<th style="text-align:right;">
Accident_Severity
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2017010001708
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009342
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009344
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009348
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009350
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009351
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:unnamed-chunk-101">Table 4.15: </span>Date and weekday information for accidents
</caption>
<thead>
<tr>
<th style="text-align:left;">
acc_index
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:right;">
Day_of_Week
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2017010001708
</td>
<td style="text-align:left;">
2017-08-05
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009342
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009344
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009348
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009350
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009351
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>Let’s say we want acc_index and Police_Force from the first table, and Date from the second table.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1"><span class="co"># select specific columns from each table and left join</span></a>
<a class="sourceLine" id="cb136-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb136-3" data-line-number="3"></a>
<a class="sourceLine" id="cb136-4" data-line-number="4">road_acc_<span class="dv">3</span> &lt;-<span class="st"> </span>road_acc_<span class="dv">1</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-5" data-line-number="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(acc_index, Police_Force) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-6" data-line-number="6"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">left_join</span>(<span class="kw">select</span>(road_acc_<span class="dv">2</span>, acc_index, Date), <span class="dt">by =</span> <span class="st">&quot;acc_index&quot;</span>)</a></code></pre></div>
<p>The above code takes the first table and uses the select statement to select the required columns from the first table.</p>
<p>Then within the left_join command, to select the data from the second table, you again add the select statement.</p>
<p><strong>Note: you will need to select the joining variable in both tables but this will only appear once</strong></p>
<table>
<caption>
<span id="tab:unnamed-chunk-103">Table 4.16: </span>Police force and Date information for specific accidents
</caption>
<thead>
<tr>
<th style="text-align:left;">
acc_index
</th>
<th style="text-align:right;">
Police_Force
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2017010001708
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-08-05
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009342
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-01-01
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009344
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-01-01
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009348
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-01-01
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009350
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-01-01
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009351
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-01-01
</td>
</tr>
</tbody>
</table>
</div>
<div id="sum-rows-or-columns" class="section level2">
<h2><span class="header-section-number">4.10</span> Sum rows or columns</h2>
<p>These solutions use the base R functions rather than dplyr.</p>
<div id="sum-rows" class="section level3">
<h3><span class="header-section-number">4.10.1</span> Sum rows</h3>
<p>To sum across a row:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="co"># sum across a row </span></a>
<a class="sourceLine" id="cb137-2" data-line-number="2">road_accidents_weekdays<span class="op">$</span>rowsum &lt;-<span class="st"> </span><span class="kw">rowSums</span>(road_accidents_weekdays, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) </a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-105">Table 4.17: </span>Road accidents 2017 by accident severity and weekday
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
1
</th>
<th style="text-align:right;">
2
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
5
</th>
<th style="text-align:right;">
6
</th>
<th style="text-align:right;">
7
</th>
<th style="text-align:right;">
rowsum
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
<td style="text-align:right;">
205
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:right;">
233
</td>
<td style="text-align:right;">
220
</td>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
281
</td>
<td style="text-align:right;">
1677
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3009
</td>
<td style="text-align:right;">
2948
</td>
<td style="text-align:right;">
3230
</td>
<td style="text-align:right;">
3227
</td>
<td style="text-align:right;">
3246
</td>
<td style="text-align:right;">
3649
</td>
<td style="text-align:right;">
3225
</td>
<td style="text-align:right;">
22536
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11668
</td>
<td style="text-align:right;">
14783
</td>
<td style="text-align:right;">
16065
</td>
<td style="text-align:right;">
15859
</td>
<td style="text-align:right;">
16331
</td>
<td style="text-align:right;">
17346
</td>
<td style="text-align:right;">
13720
</td>
<td style="text-align:right;">
105775
</td>
</tr>
</tbody>
</table>
<p>To sum across specific rows:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1"><span class="co"># sum across specific rows </span></a>
<a class="sourceLine" id="cb138-2" data-line-number="2">road_accidents_weekdays<span class="op">$</span>alldays &lt;-<span class="st"> </span>road_accidents_weekdays<span class="op">$</span><span class="st">`</span><span class="dt">1</span><span class="st">`</span> <span class="op">+</span><span class="st"> </span>road_accidents_weekdays<span class="op">$</span><span class="st">`</span><span class="dt">2</span><span class="st">`</span><span class="op">+</span></a>
<a class="sourceLine" id="cb138-3" data-line-number="3"><span class="st">                                    </span>road_accidents_weekdays<span class="op">$</span><span class="st">`</span><span class="dt">3</span><span class="st">`</span><span class="op">+</span><span class="st"> </span>road_accidents_weekdays<span class="op">$</span><span class="st">`</span><span class="dt">4</span><span class="st">`</span><span class="op">+</span></a>
<a class="sourceLine" id="cb138-4" data-line-number="4"><span class="st">                                    </span>road_accidents_weekdays<span class="op">$</span><span class="st">`</span><span class="dt">5</span><span class="st">`</span><span class="op">+</span><span class="st"> </span>road_accidents_weekdays<span class="op">$</span><span class="st">`</span><span class="dt">6</span><span class="st">`</span><span class="op">+</span></a>
<a class="sourceLine" id="cb138-5" data-line-number="5"><span class="st">                                    </span>road_accidents_weekdays<span class="op">$</span><span class="st">`</span><span class="dt">7</span><span class="st">`</span></a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-107">Table 4.18: </span>Road accidents 2017 by accident severity and weekday
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
1
</th>
<th style="text-align:right;">
2
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
5
</th>
<th style="text-align:right;">
6
</th>
<th style="text-align:right;">
7
</th>
<th style="text-align:right;">
alldays
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
<td style="text-align:right;">
205
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:right;">
233
</td>
<td style="text-align:right;">
220
</td>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
281
</td>
<td style="text-align:right;">
1676
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3009
</td>
<td style="text-align:right;">
2948
</td>
<td style="text-align:right;">
3230
</td>
<td style="text-align:right;">
3227
</td>
<td style="text-align:right;">
3246
</td>
<td style="text-align:right;">
3649
</td>
<td style="text-align:right;">
3225
</td>
<td style="text-align:right;">
22534
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11668
</td>
<td style="text-align:right;">
14783
</td>
<td style="text-align:right;">
16065
</td>
<td style="text-align:right;">
15859
</td>
<td style="text-align:right;">
16331
</td>
<td style="text-align:right;">
17346
</td>
<td style="text-align:right;">
13720
</td>
<td style="text-align:right;">
105772
</td>
</tr>
</tbody>
</table>
</div>
<div id="sum-columns" class="section level3">
<h3><span class="header-section-number">4.10.2</span> Sum columns</h3>
<p>To sum columns to get totals of each column, <strong><em>note this will appear as a console output not in a data object</em></strong>:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="co"># sum columns</span></a>
<a class="sourceLine" id="cb139-2" data-line-number="2"><span class="kw">colSums</span>(road_accidents_weekdays, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) </a></code></pre></div>
<p>To get the totals of each column as a row in the data:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1"><span class="co"># create total column</span></a>
<a class="sourceLine" id="cb140-2" data-line-number="2">road_accidents_weekdays &lt;-<span class="st"> </span>road_accidents_weekdays <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb140-3" data-line-number="3"><span class="st">  </span>janitor<span class="op">::</span><span class="kw">adorn_totals</span>(<span class="st">&quot;row&quot;</span>)</a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-110">Table 4.19: </span>Road accidents 2017 by accident severity and weekday
</caption>
<thead>
<tr>
<th style="text-align:left;">
Accident_Severity
</th>
<th style="text-align:right;">
1
</th>
<th style="text-align:right;">
2
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
5
</th>
<th style="text-align:right;">
6
</th>
<th style="text-align:right;">
7
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
300
</td>
<td style="text-align:right;">
205
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:right;">
233
</td>
<td style="text-align:right;">
220
</td>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
281
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
3009
</td>
<td style="text-align:right;">
2948
</td>
<td style="text-align:right;">
3230
</td>
<td style="text-align:right;">
3227
</td>
<td style="text-align:right;">
3246
</td>
<td style="text-align:right;">
3649
</td>
<td style="text-align:right;">
3225
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
11668
</td>
<td style="text-align:right;">
14783
</td>
<td style="text-align:right;">
16065
</td>
<td style="text-align:right;">
15859
</td>
<td style="text-align:right;">
16331
</td>
<td style="text-align:right;">
17346
</td>
<td style="text-align:right;">
13720
</td>
</tr>
<tr>
<td style="text-align:left;">
Total
</td>
<td style="text-align:right;">
14977
</td>
<td style="text-align:right;">
17936
</td>
<td style="text-align:right;">
19482
</td>
<td style="text-align:right;">
19319
</td>
<td style="text-align:right;">
19797
</td>
<td style="text-align:right;">
21245
</td>
<td style="text-align:right;">
17226
</td>
</tr>
</tbody>
</table>
<p>Reshape2 can also be used to get column totals when pivoting a table (See 5.1).</p>
</div>
</div>
<div id="replace-nas-or-other-values" class="section level2">
<h2><span class="header-section-number">4.11</span> Replace NAs or other values</h2>
<p>To replace all NAs in one column (Junction Control column) with a specific value:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1"><span class="kw">library</span> (tidyr)</a>
<a class="sourceLine" id="cb141-2" data-line-number="2"><span class="co"># replace all NAs with value -1</span></a>
<a class="sourceLine" id="cb141-3" data-line-number="3">road_accidents_na<span class="op">$</span>Junction_Control &lt;-<span class="st"> </span>road_accidents_na<span class="op">$</span>Junction_Control <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-4" data-line-number="4"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">replace_na</span>(<span class="op">-</span><span class="dv">1</span>)</a></code></pre></div>
<p><strong>Note: To replace NA with a character the character replacement must be wrapped in “quotations”</strong></p>
<p>To replace all NAs in a data frame or tibble:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1"><span class="co"># replace all NAs with value -1</span></a>
<a class="sourceLine" id="cb142-2" data-line-number="2">road_accidents_na &lt;-<span class="st"> </span>road_accidents_na <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-3" data-line-number="3"><span class="st">  </span><span class="kw">replace</span>(<span class="kw">is.na</span>(.), <span class="dv">-1</span>)</a></code></pre></div>
<p>To replace values with NA, specify what value you want to be replaced with NA using the na_if function:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1"><span class="co"># create nas</span></a>
<a class="sourceLine" id="cb143-2" data-line-number="2">road_accidents_na &lt;-<span class="st"> </span>road_accidents_na <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb143-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">na_if</span>(<span class="op">-</span><span class="dv">1</span>)</a></code></pre></div>
<p><strong>Note: to only create NAs in a specific column specify the column name in a similar manner to the first example in this section.</strong></p>
<p>To replace values:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1"><span class="co"># replace 1st_road_class </span></a>
<a class="sourceLine" id="cb144-2" data-line-number="2">road_accidents_na &lt;-<span class="st"> </span>road_accidents_na <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">1st_Road_Class</span><span class="st">`</span> =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">case_when</span>(<span class="st">`</span><span class="dt">1st_Road_Class</span><span class="st">`</span> <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;A Road&quot;</span>,</a>
<a class="sourceLine" id="cb144-4" data-line-number="4">                                      <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(<span class="st">`</span><span class="dt">1st_Road_Class</span><span class="st">`</span>)))</a></code></pre></div>
<p>The case_when function is similar to using CASE WHEN in SQL.</p>
<p>The TRUE argument indicates that if the values aren’t included in the case_when then they should be whatever is after the tilda (~) i.e. the equivalent of the ELSE statement in SQL.</p>
<p>The “as.character” parameter says that everything that isn’t 3 should be kept as it is, this could be replaced by an arbitrary character or value e.g. “Other”. This would make everything that is not a 3, coded as “Other”.</p>
<p>You can have multiple case_when arguments for multiple values, they just need to be seperated with a comma. Multiple case_when statements for different variables can be layered using the pipe operator <code>%&gt;%</code>.</p>
</div>
<div id="reordering-rowscolumns" class="section level2">
<h2><span class="header-section-number">4.12</span> Reordering rows/columns</h2>
<div id="reordering-rows" class="section level3">
<h3><span class="header-section-number">4.12.1</span> Reordering rows</h3>
<p>Rows can be reordered by certain variables using the dplyr arrange function with examples in the <strong>Order data</strong> sub-chapter. This will order the data in ascending order by the variables quoted. To order rows in descending order the <code>desc()</code> command can be used within the arrange function.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1"><span class="co"># Order data by date and number of casualties</span></a>
<a class="sourceLine" id="cb145-2" data-line-number="2">road_accidents_ordered_desc &lt;-<span class="st"> </span>road_acc_<span class="dv">7</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(acc_index, Accident_Severity, Police_Force, Number_of_Casualties, Date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-4" data-line-number="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">arrange</span>(<span class="kw">desc</span>(Date), Number_of_Casualties)</a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-117">Table 4.20: </span>Road accidents 2017 ordered by date (descending) and number of casualties
</caption>
<thead>
<tr>
<th style="text-align:left;">
acc_index
</th>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Police_Force
</th>
<th style="text-align:right;">
Number_of_Casualties
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
201704ED17511
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-12-16
</td>
</tr>
<tr>
<td style="text-align:left;">
201706N034989
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-09-18
</td>
</tr>
<tr>
<td style="text-align:left;">
201763A087117
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-09-09
</td>
</tr>
<tr>
<td style="text-align:left;">
2017610033217
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-08-12
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010047469
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-07-10
</td>
</tr>
<tr>
<td style="text-align:left;">
2017471704202
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-06-29
</td>
</tr>
</tbody>
</table>
</div>
<div id="reordering-columns" class="section level3">
<h3><span class="header-section-number">4.12.2</span> Reordering columns</h3>
<p>Use the dplyr select statement to reorder columns, where the order of the variables quoted represents the order of the columns in the table.</p>
<table>
<caption>
<span id="tab:unnamed-chunk-118">Table 4.21: </span>Four columns from road accidents 2017
</caption>
<thead>
<tr>
<th style="text-align:left;">
acc_index
</th>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:right;">
Police_Force
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2017010001708
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-08-05
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009342
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009344
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009348
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009350
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010009351
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2017-01-01
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>To reorder this table we do:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1">table_reordered &lt;-<span class="st"> </span>road_accidents_<span class="dv">4</span>_cols <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Accident_Severity, Date, acc_index, Police_Force)</a></code></pre></div>
</div>
</div>
<div id="creating-new-variables" class="section level2">
<h2><span class="header-section-number">4.13</span> Creating new variables</h2>
<p>The dplyr mutate function can be used to create new variables based on current variables or other additional information.</p>
<p>For example, to create a new variable which is speed limit in km:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1">road_acc_km &lt;-<span class="st"> </span>road_acc_<span class="dv">7</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">speed_km =</span> Speed_limit <span class="op">*</span><span class="st"> </span><span class="fl">1.6</span>)</a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-121">Table 4.22: </span>Road accidents by km/h
</caption>
<thead>
<tr>
<th style="text-align:left;">
acc_index
</th>
<th style="text-align:right;">
Police_Force
</th>
<th style="text-align:right;">
Speed_limit
</th>
<th style="text-align:right;">
speed_km
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2017471704202
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
48
</td>
</tr>
<tr>
<td style="text-align:left;">
201704ED17511
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
48
</td>
</tr>
<tr>
<td style="text-align:left;">
201706N034989
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
48
</td>
</tr>
<tr>
<td style="text-align:left;">
2017010047469
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
48
</td>
</tr>
<tr>
<td style="text-align:left;">
2017610033217
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
48
</td>
</tr>
<tr>
<td style="text-align:left;">
201763A087117
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
96
</td>
</tr>
</tbody>
</table>
</div>
<div id="summarising-data" class="section level2">
<h2><span class="header-section-number">4.14</span> Summarising data</h2>
<p>The dplyr summarise function can be used to summarise data (mean, median, sd, min, max, n_distinct). See <a href="https://dplyr.tidyverse.org/reference/summarise.html" class="uri">https://dplyr.tidyverse.org/reference/summarise.html</a> for more examples.</p>
<p>For example, to get the mean number of accidents for each weekday:</p>
<table>
<caption>
<span id="tab:unnamed-chunk-122">Table 4.23: </span>Road accidents 2017, by severity and weekday
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
205
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
187
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
233
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
220
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
250
</td>
</tr>
</tbody>
</table>
<p>The group by function is used with the summarise function to specify what groups the mean will be applied to, in this case weekday.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1">road_acc_mean &lt;-<span class="st"> </span>road_accidents_small <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb148-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(Day_of_Week) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb148-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(n))</a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-124">Table 4.24: </span>Mean number of accidents in 2017, by weekday
</caption>
<thead>
<tr>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
mean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4992.333
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5978.667
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6494.000
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
6439.667
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6599.000
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
7081.667
</td>
</tr>
</tbody>
</table>
</div>
<div id="look-up-tables" class="section level2">
<h2><span class="header-section-number">4.15</span> Look up tables</h2>
<p>Aside from importing a seperate lookup data file into R, named vectors can be used as lookup tables.</p>
<p>For example, to assign accident severity values with labels, named vectors can be used (<strong>note: numbers must also be in quotation marks</strong>):</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1">lookup_severity &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span> =<span class="st"> &quot;Fatal&quot;</span>, <span class="st">&quot;2&quot;</span> =<span class="st"> &quot;Serious&quot;</span>, <span class="st">&quot;3&quot;</span> =<span class="st"> &quot;Slight&quot;</span>)</a></code></pre></div>
<p>To convert the data and create a label variable (<strong>note: the Accident_Severity variable values can be replaced with the lookup values by changing the name of the variable on the left to Accident_Severity</strong>):</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1">road_accidents_small<span class="op">$</span>Accident_Severity_label &lt;-<span class="st"> </span>lookup_severity[road_accidents_small<span class="op">$</span>Accident_Severity]</a></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-127">Table 4.25: </span>Road accidents 2017, by severity and weekday
</caption>
<thead>
<tr>
<th style="text-align:right;">
Accident_Severity
</th>
<th style="text-align:right;">
Day_of_Week
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:left;">
Accident_Severity_label
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
300
</td>
<td style="text-align:left;">
Fatal
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
205
</td>
<td style="text-align:left;">
Fatal
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:left;">
Fatal
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
233
</td>
<td style="text-align:left;">
Fatal
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
220
</td>
<td style="text-align:left;">
Fatal
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
250
</td>
<td style="text-align:left;">
Fatal
</td>
</tr>
</tbody>
</table>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-import.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dates.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
